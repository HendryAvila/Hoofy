> ⚡ Auto-generated by sdd_reverse_engineer — review and refine as needed

# Hoofy — Requirements

> Generated by [SDD-Hoffy](https://github.com/HendryAvila/Hoofy) | Stage 2: Specify

## Functional Requirements

### Must Have

- **FR-001**: MCP server MUST communicate via stdio transport using the MCP protocol (mcp-go SDK v0.44.0)
- **FR-002**: Project pipeline MUST enforce 8 sequential stages: init → propose → specify → business-rules → clarify → design → tasks → validate
- **FR-003**: Clarity Gate MUST block pipeline advancement until clarity score meets threshold (Guided=70/100, Expert=50/100)
- **FR-004**: Clarity Gate MUST evaluate 8 dimensions: target_users, core_functionality, data_model, integrations, edge_cases, security, scale_performance, scope_boundaries
- **FR-005**: Project state MUST persist in `sdd/sdd.json` in the user's project directory
- **FR-006**: Stage artifacts MUST be saved as markdown files in `sdd/<stage>.md`
- **FR-007**: System MUST support two modes: Guided (non-technical users) and Expert (developers) with different Clarity Gate thresholds
- **FR-008**: Change pipeline MUST support 4 types (feature, fix, refactor, enhancement) × 3 sizes (small, medium, large) = 12 flow variants
- **FR-009**: Change pipeline MUST enforce one active change at a time
- **FR-010**: Change artifacts MUST be stored in `sdd/changes/<slug>/` with slugified change descriptions
- **FR-011**: Completed changes MUST be archivable to `sdd/history/`
- **FR-012**: Memory system MUST persist observations, sessions, and user prompts in SQLite with WAL mode
- **FR-013**: Memory MUST support full-text search via FTS5 with input sanitization
- **FR-014**: Memory MUST support knowledge graph relations between observations (relates_to, implements, depends_on, caused_by, supersedes, part_of)
- **FR-015**: Memory MUST support session management (start, end, summary) for tracking coding sessions
- **FR-016**: Memory MUST deduplicate observations via normalized content hash within a configurable time window (default 15 min)
- **FR-017**: Memory MUST support topic_key upsert — updating existing observations on the same topic instead of creating duplicates
- **FR-018**: Memory MUST support namespace isolation for multi-agent scenarios
- **FR-019**: Memory MUST support progress documents — structured JSON progress that survives context window compaction
- **FR-020**: Memory MUST support compaction — identifying and soft-deleting stale observations with optional summary replacement
- **FR-021**: Self-update system MUST check GitHub Releases API for newer versions and perform atomic binary replacement
- **FR-022**: CLI MUST support `serve`, `update`, and `version` commands
- **FR-023**: Context-check stage MUST scan existing specs, completed changes, and memory for context relevant to the current change
- **FR-024**: ADR (Architecture Decision Record) tool MUST capture decisions with context, rationale, alternatives, and status
- **FR-025**: Reverse-engineer tool MUST scan existing project filesystem and produce a structured report for artifact generation
- **FR-026**: Bootstrap tool MUST write missing SDD artifacts without overwriting existing ones
- **FR-027**: Memory-SDD bridge MUST automatically save stage completions as memory observations when memory is available
- **FR-028**: Pipeline tools MUST be storage-only — the AI generates content, tools save it to disk and advance state

### Should Have

- **FR-029**: Memory search SHOULD support detail levels (summary, standard, full) for token budget management
- **FR-030**: Memory context SHOULD support max_tokens budget cap to prevent context window overflow
- **FR-031**: Change pipeline SHOULD automatically select required stages based on type × size matrix
- **FR-032**: Templates SHOULD have guided and expert mode variants for each stage
- **FR-033**: Memory SHOULD support passive capture — extracting learnings from conversation content automatically
- **FR-034**: Tools SHOULD use `findProjectRoot()` to walk up directories looking for `sdd/sdd.json`, enabling use from any subdirectory

### Could Have

- **FR-035**: Support for additional MCP transports beyond stdio (HTTP, SSE)
- **FR-036**: Web-based dashboard for viewing SDD artifacts and pipeline status
- **FR-037**: Multi-project memory isolation (currently all projects share one DB)
- **FR-038**: Memory export/import for backup and migration

### Won't Have (this version)

- Will NOT provide a GUI or web interface — CLI and MCP stdio only
- Will NOT execute or compile user code — tools are storage-only
- Will NOT manage Git operations (commits, branches, PRs)
- Will NOT support real-time collaboration or multi-user access
- Will NOT embed or bundle an LLM — relies on external AI clients

## Non-Functional Requirements

- **NFR-001**: Binary MUST be statically compiled (CGO_ENABLED=0) using pure-Go SQLite (modernc.org/sqlite)
- **NFR-002**: Binary MUST be cross-platform — linux/darwin/windows on amd64/arm64 (6 targets)
- **NFR-003**: Memory observation content MUST NOT exceed 2000 characters
- **NFR-004**: All user-facing messages (update notices, progress) MUST go to stderr to keep stdout clean for MCP stdio transport
- **NFR-005**: All builds MUST pass race detector testing (`go test -race`)
- **NFR-006**: FTS5 search queries MUST sanitize user input to prevent SQL injection and syntax errors
- **NFR-007**: Self-update MUST use atomic binary replacement to prevent corruption during update
- **NFR-008**: Memory database MUST use WAL mode for concurrent read performance
- **NFR-009**: Version MUST be injected at build time via ldflags — never hardcoded
- **NFR-010**: Error handling MUST wrap errors with context using `fmt.Errorf("context: %w", err)`

## Constraints

- Go 1.25+ required (uses modern Go features)
- Depends on mcp-go v0.44.0 (Mark3Labs MCP SDK) — must track upstream API changes
- CGO_ENABLED=0 — cannot use C-based SQLite, must use modernc.org/sqlite (pure Go)
- MCP protocol constraints — tools must return `mcp.CallToolResult` with text content
- Single binary distribution — no external runtime dependencies
- GitHub Releases API for self-update — requires GitHub repository structure

## Assumptions

- Users run Hoofy as an MCP server connected to an AI coding assistant (Claude, Copilot, etc.)
- The AI client generates all content — Hoofy tools are storage/state management only
- Users have filesystem access in their project directories for sdd/ artifact storage
- GitHub Releases are accessible for self-update (no air-gapped environments)
- SQLite is sufficient for single-user memory storage (no concurrent multi-user access needed)

## Dependencies

- **mcp-go v0.44.0** (Mark3Labs) — MCP protocol SDK for Go
- **modernc.org/sqlite** — Pure Go SQLite implementation (no CGO)
- **GitHub Releases API** — Self-update mechanism
- **GoReleaser** — Cross-platform binary builds in CI/CD
- **golangci-lint** — Code quality enforcement in CI
